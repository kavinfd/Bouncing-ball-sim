<html>
<head>
	<link rel="stylesheet" type="text/css" href="main.css"/>
	<script language="javascript" type="text/javascript" src="jquery-2.1.1.js"></script>
</head>
<div id class="circle"></div>
<script type="text/javascript">
	$( document ).ready(function() {
		var gravity=0.3;
		var initVelX=2;
		var initVelY=0;
		var kickAmp=5;
		var run=true;
		var stopped = false;
		var ground = 400;
		var leftWall = 200;
		var rightWall = 800;
		var bounceGain = 0.8;
		var oscCancel = 0.3;
		function setNextPos(obj,grav,startX,startY){
			setTimeout(function(){
				var cTime = obj.currentTime;
				var displacementY = (1/2)*grav*cTime*cTime+initVelY*cTime;
				var displacementX=	initVelX*cTime;
				var currVelX = initVelX;
				var currVelY = grav*cTime+initVelY;
				var nextY=parseInt(startY+displacementY);
				var nextX=parseInt(startX+displacementX);
				obj.css("top",nextY+'px');
				obj.css("left",nextX+'px');
				obj.currentTime=cTime+1;
				var setToDrop=false;
				function checkGround(){
					initVelY=-(currVelY*bounceGain);
					console.log("initVelY : " + initVelY);
					obj.css("top",ground-oscCancel);
				}
				function checkLeft(){
					initVelX=-(currVelX*bounceGain);
					initVelY= currVelY*bounceGain;
					console.log("initVelX : "+initVelX);
					obj.css("left",leftWall+oscCancel);
				}
				function checkRight(){
					initVelX=-(currVelX*bounceGain);
					initVelY= currVelY*bounceGain;
					console.log("initVelX : "+initVelX);
					obj.css("left",rightWall-oscCancel);
				}
				if(ground<=parseInt(obj.css("top")))	{
					console.log("ground");
					checkGround();
					setToDrop=true;
				}
				if(leftWall>=parseInt(obj.css("left")))	{
					console.log("leftWall");
					checkLeft();
					setToDrop=true;
				}
				if(rightWall<=parseInt(obj.css("left")))	{
					console.log("rightWall");
					checkRight();
					setToDrop=true;
				}
				if(setToDrop){
					drop(obj);
				}else{
					setNextPos(obj,grav,startX,startY);
				}
			}, 10);
		}

		function drop(obj){
			obj.currentTime=0;
			var currX = parseInt(obj.css("left"));
			var currY = parseInt(obj.css("top"));
			setNextPos(obj,gravity,currX,currY);
		}
		/*	jQuery(function($) {
		   var currentMousePos = { x: -1, y: -1 };
		    $(document).mousemove(function(event) {
		        currentMousePos.x = event.pageX;
		        currentMousePos.y = event.pageY;
		        var d = $('.circle');
		        //$('.circle').html(currentMousePos.x+"<br/>"+currentMousePos.y);
		       // $('.circle').html(parseInt(d.css("left")));
		        d.css({left: (currentMousePos.x-parseInt(parseInt(d.css("width"))/2))+'px'});
		        d.css({top: (currentMousePos.y-parseInt(parseInt(d.css("height"))/2))+'px'});

		    });
		});*/

		var clicked=false;
		$(".circle").click(function(e){
		   	var parentOffset = $(this).offset(); //if you really just want the current element's offset
		   	var relX = e.pageX - parentOffset.left;
		   	var relY = e.pageY - parentOffset.top;
		   	var middle = parseInt($(this).css("height"))/2;
		   	var obj = $(this);
		   	//$('.circle').html(relX +"--"+relY);
			
		   	if(!clicked){
		   		clicked=true;
		   		drop($(".circle"));
		   	}else{
			   	var xvector;
			   	var yvector;

			   	if(relX<=middle){
			   		xvector=(middle-relX);
			   	}else{
			   		xvector=-(relX-middle);
			   	}

			   	if(relY<=middle){
			   		yvector=(middle-relY);
			   	}else{
			   		yvector=-(relY-middle);
			   	}
			   	var normalizedXvector = xvector/middle;
			   	var normalizedYvector = yvector/middle;
				obj.currentTime=0;
				var currX = parseInt(obj.css("left"));
				var currY = parseInt(obj.css("top"));
			   	console.log(normalizedXvector);
				console.log(normalizedYvector);
			   	initVelX=normalizedXvector*kickAmp;
			   	initVelY=normalizedYvector*kickAmp;
		   	}
		});
	});
	
	
</script>
</html>